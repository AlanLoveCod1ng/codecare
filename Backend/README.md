# Setup & Installation:

        pip install -r requirements.txt

# How to run:

Under [codecare/Backend](./) folder, run

        python3 run.py

# API Guide

## /login
It's a get/post method, must be called by a HTML form with method of post and a input text with ```id = "email"``` and a input password with ```id = "password"``` e.g.

    <form action="http://127.0.0.1:5000/login" method="post">
        <label for="email">email</label><input type="text" name="email" id="email">
        <label for="password">password</label><input type="password" name="password" id="password">
        <input type="submit">
    </form>
login will verify the email and password, generate token and redirect to ```/account```
### Message
<ul>
    <li>If form doesn't have email and password, will return message of "Error with form" and response 401.</li>
    <li>If email and password can't be verify will return message of "Could not verify!" with response 401.</li>
</ul>

## /register
Similar to [/account](#account), get/post method and ```id="first_name"```, ```id="second_name"```, ```id="email"```, ```id="password"```, ```id="phone"``` in the form are required.<br>
We only allow patient creating account so /register will only create patient account.
### Message
<ul>
    <li>If form miss input, message "Error with form," and response code 401 are returned.</li>
    <li>If error with database operation, message "Can't register" and response 401 are returned.</li>
    <li>If error with database operation, message "Can't register" and response 401 are returned.</li>
    <li>If account already exist, message "User already exists. Please Log in." and code 202 will be returned</li>
    <li>If register successfully, message "Successfully registered." and code 201 will be returned.</li>
</ul>

## Token Required
All the API call except login and register is token required. Token required means token must be passed as a parameter to API in he url. See example in the [/account](#account).<br>
Every token is generated by [/login](#/login), each token will be expired after 30 minutes, login is required once token is expired.
### Message
<ul>
    <li>If token is not included, message "Token is missing!" is returned.</li>
    <li>If token is not valid, message "Token is invalid" and response 403 is returned.</li>
</ul>

## /account

Redirect from /login, account will return a json file which contains all the information of account. Token will be included, store it because it it's required in the future API call. <br>
/account example:

        http://127.0.0.1:5000/account&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2NvdW50X2lkIjoxMSwiZXhwIjoxNjY5MjUzNzM0fQ.2YHjBmt4iEUoPb48tbLfdhel6h7I3bgjdX8saVsNrOA

returned json example
```json
{
  "account_id": 11,
  "email": "vehicula.aliquet.libero@icloud.ca",
  "first_name": "Giacomo",
  "id": 11,
  "is_patient": 0,
  "last_name": "Wall",
  "password": "3791",
  "phone": "1-284-622-9244",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2NvdW50X2lkIjoxMSwiZXhwIjoxNjY5MjUzNzM0fQ.2YHjBmt4iEUoPb48tbLfdhel6h7I3bgjdX8saVsNrOA"
}
```
### Message
No error message will be returned from /account, only possible error is in [Token Required](#token-required).


## /notification
Token required.

This API call will return list of notifications of this patient or provider in json format, except token is required as argument in url, two other types arguments are allowed to customize.

```filter```, filter accept two different parameters, ```waiting``` and ```processed```, by calling ```filter=waiting```, API will only return the notification which are waiting to be processed, ```filter=processed``` will only return the notifications that have already been processed.


```first``` will return the first few notifications after filtering. ```first=10``` will return top 10 notifications of query result.

API call example:

        /notification?filter=waiting&first=2&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2NvdW50X2lkIjoxMSwiZXhwIjoxNjY5MjUzNzM0fQ.2YHjBmt4iEUoPb48tbLfdhel6h7I3bgjdX8saVsNrOA

Here is the returned json for above API call:
```json
[
  {
    "account_id": 11,
    "city": "San Jose",
    "content": "cursus non, egestas a, dui. Cras pellentesque. Sed dictum. Proin eget odio. Aliquam vulputate ullamcorper magna. Sed eu eros. Nam consequat dolor vitae dolor. Donec fringilla. Donec feugiat metus sit amet ante. Vivamus non lorem vitae odio sagittis semper. Nam tempor diam dictum sapien. Aenean massa. Integer vitae nibh. Donec est mauris, rhoncus id, mollis nec, cursus a, enim. Suspendisse aliquet, sem ut cursus luctus, ipsum leo elementum sem, vitae aliquam eros turpis non enim. Mauris quis turpis vitae purus gravida sagittis. Duis gravida. Praesent eu nulla at sem molestie sodales. Mauris blandit enim consequat purus. Maecenas libero est, congue a, aliquet vel, vulputate eu, odio. Phasellus at augue id ante dictum cursus. Nunc mauris elit, dictum eu, eleifend nec, malesuada ut, sem. Nulla interdum. Curabitur dictum. Phasellus in felis. Nulla tempor augue ac ipsum. Phasellus vitae mauris sit amet lorem semper auctor. Mauris vel turpis. Aliquam adipiscing lobortis risus. In mi pede, nonummy ut, molestie in, tempus eu, ligula. Aenean euismod mauris eu elit. Nulla facilisi. Sed neque. Sed eget lacus. Mauris non dui nec urna suscipit nonummy. Fusce fermentum fermentum arcu. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae Phasellus ornare. Fusce mollis. Duis sit amet diam eu dolor egestas rhoncus. Proin nisl sem, consequat nec, mollis vitae, posuere at, velit. Cras lorem lorem, luctus ut, pellentesque eget, dictum placerat, augue. Sed molestie. Sed id risus",
    "datetime": "10/28/2018, 00:07:15",
    "state": "California",
    "waiting to be processed": 1
  },
  {
    "account_id": 11,
    "city": "Sacramento",
    "content": "in lobortis tellus justo sit amet nulla. Donec non justo. Proin non massa non ante bibendum ullamcorper. Duis cursus, diam at pretium aliquet, metus urna convallis erat, eget tincidunt dui augue eu tellus. Phasellus elit pede, malesuada vel, venenatis vel, faucibus id, libero. Donec consectetuer mauris id sapien. Cras dolor dolor, tempus non, lacinia at, iaculis quis, pede. Praesent eu dui. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aenean eget magna. Suspendisse tristique neque venenatis lacus. Etiam bibendum fermentum metus. Aenean sed pede nec ante blandit viverra. Donec tempus, lorem fringilla ornare placerat, orci lacus vestibulum lorem, sit amet ultricies sem magna nec quam. Curabitur vel lectus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec dignissim magna a tortor. Nunc commodo auctor velit. Aliquam nisl. Nulla eu",
    "datetime": "07/01/2021, 00:43:38",
    "state": "California",
    "waiting to be processed": 1
  }
]
```

This one will return first 10 notifications which are waiting to be processed.

TODO: I plan to return notification sorted by datetime automatically, that is, the most recent notification will be on the top.

TODO: This one only supports provider version, patient one is still under development.

## /record
Token required

This API is for patient only which will return patient's locations record in json file. /record has one extra allowed argument.

```first``` same as [/notification](#notification).

TODO: I plan to return record sorted by datetime automatically, that is, the most recent notification will be on the top.

### Message
<ul>
    <li>If given token is for provider, message "Patient Only." and code 403 will be returned</li>
    <li>If something wrong with query, message "Can't fetch data" and code 401 will be returned.</li>
</ul>
